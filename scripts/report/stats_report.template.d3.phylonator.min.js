if(!d3){throw"d3 wasn't included!"}(function(){function e(e,t){var n=function(e,t){t(e);if(e.children){for(var r=e.children.length-1;r>=0;r--){n(e.children[r],t)}}};n(e[0],function(e){e.rootDist=(e.parent?e.parent.rootDist:0)+(e.data.length||0)});var r=e.map(function(e){return e.rootDist});var i=d3.scale.linear().domain([0,d3.max(r)]).range([0,t]);n(e[0],function(e){e.y=i(e.rootDist)});return i}d3.phylonator={};d3.phylonator.rightAngleDiagonal=function(){function n(n,r){var i=n.source,s=n.target,o=(i.x+s.x)/2,u=(i.y+s.y)/2,a=[i,{x:s.x,y:i.y},s];a=a.map(e);return t(a)}var e=function(e){return[e.y,e.x]};var t=function(e){return"M"+e[0]+" "+e[1]+" "+e[2]};n.projection=function(t){if(!arguments.length)return e;e=t;return n};n.path=function(e){if(!arguments.length)return t;t=e;return n};return n};d3.phylonator.radialRightAngleDiagonal=function(){return d3.phylonator.rightAngleDiagonal().path(function(e){var t=e[0],n=e[1],r=e[2],i=Math.sqrt(t[0]*t[0]+t[1]*t[1]),s=d3.phylonator.coordinateToAngle(t,i),o=d3.phylonator.coordinateToAngle(n,i),u=Math.abs(o-s)>Math.PI?o<=s:o>s,a=0,f=0,l=u?0:1;return"M"+t+" "+"A"+[i,i]+" "+a+" "+f+","+l+" "+n+"L"+r}).projection(function(e){var t=e.y,n=(e.x-90)/180*Math.PI;return[t*Math.cos(n),t*Math.sin(n)]})};d3.phylonator.coordinateToAngle=function(e,t){var n=2*Math.PI,r=n/4;var i=e[0]>=0?e[1]>=0?1:2:e[1]>=0?4:3,s=Math.abs(Math.asin(e[1]/t));switch(i){case 1:coordAngle=r-s;break;case 2:coordAngle=r+s;break;case 3:coordAngle=2*r+r-s;break;case 4:coordAngle=3*r+s}return coordAngle};d3.phylonator.styleTreeNodes=function(e,t){function i(t,n,r){var s=n;var o=t;e.selectAll("path.link").attr("y2",function(e){if(e.target.y==s&&e.target.x==o){var t=d3.select(this);t.attr("stroke","rgba(255,0,0,"+r+")");s=e.source.y;o=e.source.x;r=r-.1;if(s!=0){i(o,s,r)}}})}var n=function(){var e=d3.select(this);e.attr("fill","steelblue");e.attr("r",3.5)};var r=function(){var e=d3.select(this);e.attr("fill","white");e.attr("r",2.5)};e.selectAll("g.leaf.node").append("svg:circle").attr("r",2.5).attr("class",function(e){return e.type}).attr("stroke","steelBlue").attr("fill","white").attr("stroke-width","1.5px").on("mouseout",function(e){var t=d3.select(this);t.attr("fill","white");t.attr("r",2.5)}).on("mouseover",function(e){var t=d3.select(this);t.attr("fill","steelblue");t.attr("r",3.5);var n=e.y;var r=e.x;var s=1;i(r,n,s)}).on("click",function(e){var t=d3.select(this);t.attr("fill","steelblue");t.attr("r",3.5);var n=e.y;var r=e.x;var s=1;i(r,n,s)});e.selectAll("g.root.node").append("svg:circle").attr("r",4.5).attr("fill","steelblue").attr("stroke","#369").attr("stroke-width","1.5px")};d3.phylonator.build=function(t,n,r){function c(){l.attr("transform","translate("+d3.event.translate+")"+" scale("+d3.event.scale+")")}function g(e,t){return m[e.index+","+t.index]||m[t.index+","+e.index]||e.index==t.index}function y(e){return function(t){d.style("stroke-opacity",function(n){thisOpacity=g(t,n)?1:e;this.setAttribute("fill-opacity",thisOpacity);return thisOpacity});p.style("stroke-opacity",function(n){return n.source===t||n.target===t?1:e})}}r=r||{};var i=r.width||d3.select(t).style("width")||d3.select(t).attr("width"),s=r.height||d3.select(t).style("height")||d3.select(t).attr("height"),i=parseInt(i),s=parseInt(s),o=d3.scale.linear().domain([0,i]).range([0,i]),u=d3.scale.linear().domain([0,s]).range([0,s]);var a=r.tree||d3.layout.cluster().size([s,i]).children(r.children||function(e){return e.branchset});var f=r.diagonal||d3.phylonator.rightAngleDiagonal();var l=r.vis||d3.select(t).append("svg:svg").attr("width",i+300).attr("height",s+30).attr("pointer-events","all").append("svg:g").call(d3.behavior.zoom().scaleExtent([1,5]).on("zoom",c)).append("svg:g").attr("transform","translate(0, 0)").attr("id","phylonator_svg");var n=a(n);l.append("svg:rect").attr("width",i).attr("height",s).attr("fill","white");if(r.skipBranchLengthScaling){var h=d3.scale.linear().domain([0,i]).range([0,i])}else{var h=e(n,i)}if(!r.skipTicks){l.selectAll("line").data(h.ticks(10)).enter().append("svg:line").attr("y1",0).attr("y2",s).attr("x1",h).attr("x2",h).attr("stroke","#ddd");l.selectAll("text.rule").data(h.ticks(10)).enter().append("svg:text").attr("class","rule").attr("x",h).attr("y",0).attr("dy",-3).attr("text-anchor","middle").attr("font-size","8px").attr("fill","#ccc").text(function(e){return Math.round(e*100)/100})}var p=l.selectAll("path.link").data(a.links(n)).enter().append("svg:path").attr("class","link").attr("d",f).attr("fill","none").attr("stroke","#aaa").attr("stroke-width","1.5px").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y});var d=l.selectAll("g.node").data(n).enter().append("svg:g").attr("class",function(e){if(e.children){if(e.depth==0){return"root node"}else{return"inner node"}}else{return"leaf node"}}).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});var v=l.selectAll("g.leaf.node").on("click",function(e){d3.selectAll("."+e.type).style("fill","red")});var m={};a.links(n).forEach(function(e){m[e.source.index+","+e.target.index]=1});d3.phylonator.styleTreeNodes(l,n);if(!r.skipLabels){l.selectAll("g.leaf.node").append("svg:text").attr("dx",8).attr("dy",3).attr("text-anchor","start").attr("font-family","Helvetica Neue, Helvetica, sans-serif").attr("font-size","10px").attr("fill","black").attr("pointer-events","all").text(function(e){return e.data.name+" ("+e.data.length+")"})}if(d3.tipsy){$("g.node").tipsy({gravity:"w",html:true,title:function(){var e=this.__data__;return e.data.name}})}return{tree:a,vis:l}}})()